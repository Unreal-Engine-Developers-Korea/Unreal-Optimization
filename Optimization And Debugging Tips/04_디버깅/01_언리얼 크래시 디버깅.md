# 언리얼 크래시 마스터하기 

### 자주 발생하는 크래시 원인
- 보통 메모리 관련 문제
    - `nullptr`를 읽으려고 해서
    - 없는 배열 인덱스를 읽으려고 해서
    - GPU 메모리가 부족해서
    - 기타 등등
 ### 언리얼이 크래시하면 뭐가 일어나나요?
1. `/Saved/Crashes` 폴더에 로그 + 크래시 파일 생성 
   - `.dmp` 미니덤프 파일
   - `.runtime-xml` 파일
   - `.log` 파일
   - 참고1: Shipping 버전은 `/Saved/Crashes`를 게임폴더 안에 생성안함
       - `%UserProfile%/AppData/프로젝트파일/` (`%UserProfile%` 본인 계정 폴더 이름으로 대체)
   - 참고2: Shipping 버전에서는 _**로그 파일이 생성이 안됨**_
     - 로그파일이 필요하다면 프로젝트 `.Target.cs` 파일에 `bUseLoggingInShipping = true` 추가해야함
2. 크래시 창이 뜬다
   - 패키지 빌드에서는 비활성화 돼있으니 한번 확인
     - `Project Settings -> Packaging`에서 `Include Crash Reporter` 활성화
   - 코드 에디터에서 실행했으면 보통 크래시나는 코드에서 정지
   - `.dmp` 파일을 `.runtime-xml`로 심볼리케이션 함
3. (선택 - Shipping 버전) `.pdb` (Program Debug Database 파일) 생성
    - 따로 활성화해줘야함 -> `Project Settings -> Packaging`에서 `Include Debug Files` 활성화
    - 크래시하면 `프로젝트파일/Binaries` 폴더 안에 생성됨
      - 코드 심볼이 다 여기 있음
      - 디버깅하는 용도로만 사용하기 때문에 유저한테 공유하지 않고 개발자들만 소유하면 됨
    - 팁: 보통 `.pdb` 파일은 Shipping 패키징하면 바로 잘라내고 개발자 개인 폴더로 붙여넣으면 됨
      - 외부자가 이 파일로 게임을 역설계할 수 있음
      - 사이즈가 상다히 큼
# 크래시 파일 설명

### 1. CrashContext.runtime.xml
- 크래시했을 때 관련 정보들을 저장한 파일
  - 기기 정보
  - 빌드 타입
  - 언리얼 버전
  - 플러그인 리스트
  - **_콜 스택_**
  - 기타 등등
### 2. CrashReportClient.ini
- 클라이언트 크래시 알림 세팅 (신경 안써도됨)
### 3. UEMinidump.dmp
- 언리얼에서 크래시한 당시 호출된 Call Stack 파일 (비주얼 스튜디오)
### 4. 프로젝트이름.log 파일
- 언리얼 LOG를 다 저장한 파일
- 꿀팁: UE_LOG도 여기 저장됨

## Crash Context로 디버깅하기
- `<ErrorMessage>`: 에러 메세지 
- `<IsEnsure>`, `<IsAssert>`: 어서트 관련 크래시 여부
- `<IsStall>`: CPU 또는 GPU stall 여부 -> 코드명령이 너무 오래 걸리거나 무거운 연산이 필요하면 클래시할 수 있음
#### 기기 정보
- `<PlatformFullname>`: 운영체제 -> 윈도우 외에 다른 운영체제에만 있는 버그면 유용한 정보
- `<RHI.RHIName>`: 특히 VR 프로젝트 할 때 힌트가 될 수 있음
  - 예: 한때 D3D12 (DirectX12)이 GPU 크래시 원인이었음
- `<RHI.RHIAdapterName>`: 그래픽카드 정보 -> GPU 크래시면 대충 GPU 메모리가 부족한건지 바로 알 수 있음
  - 예) GTX 1650은 4GB VRAM을 보유하고 있어서 게임 내에 텍스쳐 용량이 너무 크면 크래시할 수 있음. 특히 VR은 화면을 두개 렌더링 하기 때문에 더 무거움     
#### 엔진 정보 
- `<EngineVersion>`: 언리얼 버전 -> 특히 신기능이면 버전마다 코드가 조금씩 다를 수 있기 때문에 도움이 되는 정보임
- `<BuildConfiguration>`: 빌드 종류 -> `Shipping` 패키지 버전은 불필요한 모듈을 비활성화하는데 가끔 크래시 원인이 될 수 있음
    - 예: UnrealEd (언리얼 에디터 관련 모듈) - 패키지 버전에 `UnrealEd` 모듈은 필요없기 때문에 비활성화되지만 이 모듈에 의존성이 있는 모듈이 있다면 크래시가 발생할 수 있음
      - 애초에 패키지 자체가 실패하겠지만 가끔씩 예상하지 못하는 버그가 발생할 수 있기 때문에 빌드타입 정보가 힌트가 될 수 있음
- `<EnabledPlugins>`: 플러그인 리스트 -> 문제가 될만한 플러그인이 있는지 확인할 때 도움이 많이 됨
#### 콜 스택
- 콜 스택은 하 -> 상 순서로 호출됨
- 언리얼 엔진 소스 코드를 볼 수 있기 때문에 크래시 원인을 더 깊게 파혜칠 수 있음
- `<SourceContext>` 키워드를 찾고 

## 미니덤프로 디버깅하기

